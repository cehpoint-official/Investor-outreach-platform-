<!DOCTYPE html>
<html>
<head>
    <title>Frontend Test</title>
</head>
<body>
    <h1>Frontend Test Results</h1>
    <div id="results"></div>
    
    <script>
        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>üß™ Testing Frontend...</h2>';
            
            // Clear existing data
            localStorage.removeItem('clients');
            localStorage.removeItem('campaigns');
            results.innerHTML += '<p>‚úÖ Cleared existing data</p>';
            
            // Test 1: Add client to localStorage
            const testClient = {
                id: Date.now().toString(),
                company_name: 'Frontend Test Corp',
                first_name: 'John',
                last_name: 'Doe',
                email: 'john@frontendtest.com',
                phone: '+1-555-9999',
                fund_stage: 'Series A',
                location: 'India',
                industry: 'Fintech',
                revenue: '2.5M',
                investment_ask: '8M',
                createdAt: new Date().toISOString(),
                archive: false
            };
            
            const clients = [testClient];
            localStorage.setItem('clients', JSON.stringify(clients));
            results.innerHTML += '<p>‚úÖ Test client added: ' + testClient.company_name + '</p>';
            results.innerHTML += '<p>   Revenue: ' + testClient.revenue + ' (string)</p>';
            results.innerHTML += '<p>   Investment: ' + testClient.investment_ask + ' (string)</p>';
            
            // Test 2: Add campaign to localStorage
            const testCampaign = {
                id: Date.now().toString(),
                name: testClient.company_name + '_' + testClient.fund_stage + '_Outreach',
                clientId: testClient.id,
                clientName: testClient.company_name,
                location: testClient.location,
                type: 'Email',
                status: 'Draft',
                recipients: 3,
                createdAt: new Date().toISOString(),
                audience: [
                    { name: 'Test Investor 1', email: 'inv1@test.com', score: 95 },
                    { name: 'Test Investor 2', email: 'inv2@test.com', score: 87 }
                ]
            };
            
            const campaigns = [testCampaign];
            localStorage.setItem('campaigns', JSON.stringify(campaigns));
            results.innerHTML += '<p>‚úÖ Test campaign added: ' + testCampaign.name + '</p>';
            results.innerHTML += '<p>   Status: ' + testCampaign.status + '</p>';
            results.innerHTML += '<p>   Recipients: ' + testCampaign.recipients + '</p>';
            
            // Test 3: Test API endpoints
            results.innerHTML += '<h3>Testing API Endpoints:</h3>';
            
            try {
                // Test client API
                const clientResponse = await fetch('/api/clients', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        firstName: 'API',
                        lastName: 'Test',
                        email: 'api@test.com',
                        phone: '+1-555-7777',
                        companyName: 'API Test Company',
                        industry: 'Technology',
                        fundingStage: 'Seed',
                        location: 'US',
                        revenue: '3M',
                        investment: '12M'
                    })
                });
                
                const clientData = await clientResponse.json();
                if (clientResponse.ok && clientData.success) {
                    results.innerHTML += '<p>‚úÖ Client API working: ' + clientResponse.status + '</p>';
                } else {
                    results.innerHTML += '<p>‚ùå Client API failed: ' + clientResponse.status + '</p>';
                }
                
                // Test campaign API
                const campaignResponse = await fetch('/api/campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        clientId: 'api-test-123',
                        clientName: 'API Test Company',
                        stage: 'Seed',
                        location: 'US'
                    })
                });
                
                const campaignData = await campaignResponse.json();
                if (campaignResponse.ok && campaignData.success) {
                    results.innerHTML += '<p>‚úÖ Campaign API working: ' + campaignResponse.status + '</p>';
                    results.innerHTML += '<p>   Campaign name: ' + campaignData.campaign.name + '</p>';
                } else {
                    results.innerHTML += '<p>‚ùå Campaign API failed: ' + campaignResponse.status + '</p>';
                }
                
            } catch (error) {
                results.innerHTML += '<p>‚ùå API test error: ' + error.message + '</p>';
            }
            
            // Test 4: Verification
            results.innerHTML += '<h3>üìä Final Verification:</h3>';
            const storedClients = JSON.parse(localStorage.getItem('clients') || '[]');
            const storedCampaigns = JSON.parse(localStorage.getItem('campaigns') || '[]');
            
            results.innerHTML += '<p>Clients in localStorage: ' + storedClients.length + '</p>';
            results.innerHTML += '<p>Campaigns in localStorage: ' + storedCampaigns.length + '</p>';
            
            results.innerHTML += '<h3>üîç Manual Verification:</h3>';
            results.innerHTML += '<p>1. Go to <a href="/dashboard/all-client" target="_blank">/dashboard/all-client</a></p>';
            results.innerHTML += '<p>   - Should see "Frontend Test Corp"</p>';
            results.innerHTML += '<p>   - Revenue should show "2.5M"</p>';
            results.innerHTML += '<p>   - Investment should show "8M"</p>';
            results.innerHTML += '<p>2. Go to <a href="/dashboard/allCampaign" target="_blank">/dashboard/allCampaign</a></p>';
            results.innerHTML += '<p>   - Should see "Frontend Test Corp_Series A_Outreach"</p>';
            results.innerHTML += '<p>   - Recipients should show "3"</p>';
            results.innerHTML += '<p>3. Refresh pages - data should persist</p>';
        }
        
        // Run tests when page loads
        runTests();
    </script>
</body>
</html>